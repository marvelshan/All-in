<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Home Page</title>
    <link rel="stylesheet" type="text/css" href="home.css" />
    <link rel="icon" href="/image/logo.png" type="image/png" />
  </head>
  <body>
    <div class="header">
      <a href="/home.html"><img src="/image/logo.png" class="logo" /></a>
      <a href="/home.html" class="navbar">Home</a>
      <a href="/rank.html" class="navbar">Rank</a>
      <a href="/charge.html" class="navbar">Top Up</a>
      <a href="/record.html" class="navbar">Record</a>
      <a href="/profile.html" class="sign">Join</a>
    </div>

    <div class="discount">
      <div class="discountTitle">
        <div class="specialGameTitle">優惠項目</div>
      </div>
      <div class="subtitle">新玩家優惠</div>
      <div class="discountSubtitle">首次加入即享5000元，</div>
      <div class="discountSubtitle">立即註冊，體驗無限精彩！</div>
      <div class="signDiscountButton">
        <a href="/profile.html" class="signDiscount">立即加入</a>
      </div>
    </div>
    <div class="specialGame">
      <div class="specialGameTitle">精選賽事</div>
    </div>
    <div class="gameContainer">
      <a href="game.html?game=22200001">
        <div class="gameFrame">
          <div class="status">Live</div>
          <div class="teamImage">
            <div class="homeTeamImage"></div>
            <div class="vs">v.s</div>
            <div class="awayTeamImage"></div>
          </div>
          <div class="teamName">
            <div class="teamFrame">
              <div class="homeTeam"></div>
              <div class="homeScore"></div>
            </div>
            <div class="teamFrame">
              <div class="awayTeam"></div>
              <div class="awayScore"></div>
            </div>
          </div>
          <div class="odds">
            <div class="homeOdds"></div>
            <div class="awayOdds"></div>
          </div>
        </div>
      </a>

      <a href="game.html?game=22200002">
        <div class="gameFrame">
          <div class="status">Live</div>
          <div class="teamImage">
            <div class="homeTeamImage"></div>
            <div class="vs">v.s</div>
            <div class="awayTeamImage"></div>
          </div>
          <div class="teamName">
            <div class="teamFrame">
              <div class="homeTeam"></div>
              <div class="homeScore"></div>
            </div>
            <div class="teamFrame">
              <div class="awayTeam"></div>
              <div class="awayScore"></div>
            </div>
          </div>
          <div class="odds">
            <div class="homeOdds"></div>
            <div class="awayOdds"></div>
          </div>
        </div>
      </a>
      <a href="game.html?game=22200003">
        <div class="gameFrame">
          <div class="status">Live</div>
          <div class="teamImage">
            <div class="homeTeamImage"></div>
            <div class="vs">v.s</div>
            <div class="awayTeamImage"></div>
          </div>
          <div class="teamName">
            <div class="teamFrame">
              <div class="homeTeam"></div>
              <div class="homeScore"></div>
            </div>
            <div class="teamFrame">
              <div class="awayTeam"></div>
              <div class="awayScore"></div>
            </div>
          </div>
          <div class="odds">
            <div class="homeOdds"></div>
            <div class="awayOdds"></div>
          </div>
        </div>
      </a>
      <a href="game.html?game=22200004">
        <div class="gameFrame">
          <div class="status">Live</div>
          <div class="teamImage">
            <div class="homeTeamImage"></div>
            <div class="vs">v.s</div>
            <div class="awayTeamImage"></div>
          </div>
          <div class="teamName">
            <div class="teamFrame">
              <div class="homeTeam"></div>
              <div class="homeScore"></div>
            </div>
            <div class="teamFrame">
              <div class="awayTeam"></div>
              <div class="awayScore"></div>
            </div>
          </div>
          <div class="odds">
            <div class="homeOdds"></div>
            <div class="awayOdds"></div>
          </div>
        </div>
      </a>
    </div>

    <div class="specialGame">
      <div class="specialGameTitle">未來賽事</div>
    </div>
    <div class="futureGameFrame">
      <div class="futureTitle">Coming soon</div>
    </div>
    <div class="footer">
      <div class="brand-right">© 2023. All rights reserved.</div>
    </div>
  </body>
  <script>
    const status = document.querySelectorAll(".status");
    const homeTeamElements = document.querySelectorAll(".homeTeam");
    const awayTeamElements = document.querySelectorAll(".awayTeam");
    const futureGameFrame = document.querySelector(".futureGameFrame");
    const homeTeam = document.querySelectorAll(".homeTeam");
    const awayTeam = document.querySelectorAll(".awayTeam");
    const homeScore = document.querySelectorAll(".homeScore");
    const awayScore = document.querySelectorAll(".awayScore");
    const homeOdds = document.querySelectorAll(".homeOdds");
    const awayOdds = document.querySelectorAll(".awayOdds");
    const homeTeamImage = document.querySelectorAll(".homeTeamImage");
    const awayTeamImage = document.querySelectorAll(".awayTeamImage");

    fetch("/game/infor", {
      method: "GET",
      headers: {
        "Content-Type": "application/json",
      },
    })
      .then((response) => {
        return response.json();
      })
      .then((data) => {
        data.forEach((game) => {
          if (game.status === "pending") {
            const time = cronToDateTime(game.time);
            const scheduleTime = document.createElement("div");
            const futureHomeFrame = document.createElement("div");
            const futureHomeImage = document.createElement("div");
            const futureHome = document.createElement("div");
            const futureAwayFrame = document.createElement("div");
            const futureAwayImage = document.createElement("div");
            const futureAway = document.createElement("div");
            const futureHomeOdds = document.createElement("div");
            const futureAwayOdds = document.createElement("div");
            const futureOdds = document.createElement("div");
            const url = document.createElement("a");
            const futurGamePerFrame = document.createElement("div");
            scheduleTime.className = "scheduleTime";
            futureHomeFrame.className = "futureHomeFrame";
            futureHomeImage.className = "futureHomeImage";
            futureAwayFrame.className = "futureHomeFrame";
            futureAwayImage.className = "futureAwayImage";
            futureHome.className = "futurePerGame";
            futureAway.className = "futurePerGame";
            futureHomeOdds.className = "futureHomeOdds";
            futureAwayOdds.className = "futureAwayOdds";
            futureOdds.className = "futureOdds";
            futurGamePerFrame.className = "futurGamePerFrame";
            futureHome.textContent = game.home_team_id;
            futureAway.textContent = game.away_team_id;
            futureHomeOdds.textContent = game.home_odds;
            futureAwayOdds.textContent = game.away_odds;
            futureHomeImage.style.backgroundImage = `url(/image/${game.home_team_id}.png)`;
            futureAwayImage.style.backgroundImage = `url(/image/${game.away_team_id}.png)`;
            scheduleTime.textContent = time.date;
            url.href = `/game.html?game=${game.GAME_ID}`;
            futurGamePerFrame.appendChild(scheduleTime);
            futureHomeFrame.appendChild(futureHomeImage);
            futureHomeFrame.appendChild(futureHome);
            futureAwayFrame.appendChild(futureAwayImage);
            futureAwayFrame.appendChild(futureAway);
            futureOdds.appendChild(futureHomeOdds);
            futureOdds.appendChild(futureAwayOdds);
            futurGamePerFrame.appendChild(futureHomeFrame);
            futurGamePerFrame.appendChild(futureAwayFrame);
            futurGamePerFrame.appendChild(futureOdds);
            url.appendChild(futurGamePerFrame);
            futureGameFrame.appendChild(url);
          }
          if (game.GAME_ID === 22200001) {
            homeTeam[0].textContent = game.home_team_id;
            awayTeam[0].textContent = game.away_team_id;
            homeTeamImage[0].style.backgroundImage = `url(/image/${game.home_team_id}.png)`;
            awayTeamImage[0].style.backgroundImage = `url(/image/${game.away_team_id}.png)`;
          } else if (game.GAME_ID === 22200002) {
            homeTeam[1].textContent = game.home_team_id;
            awayTeam[1].textContent = game.away_team_id;
            homeTeamImage[1].style.backgroundImage = `url(/image/${game.home_team_id}.png)`;
            awayTeamImage[1].style.backgroundImage = `url(/image/${game.away_team_id}.png)`;
          } else if (game.GAME_ID === 22200003) {
            homeTeam[2].textContent = game.home_team_id;
            awayTeam[2].textContent = game.away_team_id;
            homeTeamImage[2].style.backgroundImage = `url(/image/${game.home_team_id}.png)`;
            awayTeamImage[2].style.backgroundImage = `url(/image/${game.away_team_id}.png)`;
          } else if (game.GAME_ID === 22200004) {
            homeTeam[3].textContent = game.home_team_id;
            awayTeam[3].textContent = game.away_team_id;
            homeTeamImage[3].style.backgroundImage = `url(/image/${game.home_team_id}.png)`;
            awayTeamImage[3].style.backgroundImage = `url(/image/${game.away_team_id}.png)`;
          }
        });
      });
    function cronToDateTime(cronExpression) {
      const cronParts = cronExpression.split(" ");
      const [minutes, hours, day, month] = cronParts;
      const date = `2023/${month}/${day} ${hours}:${minutes}`;
      return { date };
    }
    function setTeamImage(team, element) {
      const imagePath = `/image/${team}.png`;
      return;
      `url(${imagePath})`;
    }

    function getOdds(GAME_ID) {
      fetch("/odds/getOdds", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          id: GAME_ID,
        }),
      })
        .then((response) => {
          return response.json();
        })
        .then((data) => {
          if (data.success === false) {
            return alert(data.message);
          }
          const gameEvent = JSON.parse(data);
          homeOdds[(gameEvent.id % 10) - 1].textContent = gameEvent.homeOdds;
          awayOdds[(gameEvent.id % 10) - 1].textContent = gameEvent.awayOdds;
        });
    }
    function getGameEvent(gameId) {
      fetch("/game/getGameEvent", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          id: gameId,
        }),
      })
        .then((response) => {
          return response.json();
        })
        .then((game) => {
          if (game.success === false) {
            return alert(game.message);
          }
          homeScore[(game.gameData.GAME_ID % 10) - 1].textContent =
            game.gameData.hs;
          awayScore[(game.gameData.GAME_ID % 10) - 1].textContent =
            game.gameData.vs;
        });
    }
    getOdds(22200001);
    getOdds(22200002);
    getOdds(22200003);
    getOdds(22200004);
    getGameEvent(22200001);
    getGameEvent(22200002);
    getGameEvent(22200003);
    getGameEvent(22200004);
  </script>
  <script type="importmap">
    {
      "imports": {
        "socket.io-client": "https://cdn.socket.io/4.4.1/socket.io.esm.min.js"
      }
    }
  </script>
  <script type="module">
    import { io } from "socket.io-client";

    const socket = io();
    socket.on("connection", () => {
      console.log("connected");
    });
    socket.on("gameEvent", (game) => {
      if (game.GAME_ID === 22200001) {
        homeScore[0].textContent = game.hs;
        awayScore[0].textContent = game.vs;
      } else if (game.GAME_ID === 22200002) {
        homeScore[1].textContent = game.hs;
        awayScore[1].textContent = game.vs;
      } else if (game.GAME_ID === 22200003) {
        homeScore[2].textContent = game.hs;
        awayScore[2].textContent = game.vs;
      } else if (game.GAME_ID === 22200004) {
        homeScore[3].textContent = game.hs;
        awayScore[3].textContent = game.vs;
      }
    });
    socket.on("odds", (odds) => {
      if (odds.id === 22200001) {
        homeOdds[0].textContent = odds.homeOdds;
        awayOdds[0].textContent = odds.awayOdds;
      } else if (odds.id === 22200002) {
        homeOdds[1].textContent = odds.homeOdds;
        awayOdds[1].textContent = odds.awayOdds;
      } else if (odds.id === 22200003) {
        homeOdds[2].textContent = odds.homeOdds;
        awayOdds[2].textContent = odds.awayOdds;
      } else if (odds.id === 22200004) {
        homeOdds[3].textContent = odds.homeOdds;
        awayOdds[3].textContent = odds.awayOdds;
      }
    });
  </script>
</html>
